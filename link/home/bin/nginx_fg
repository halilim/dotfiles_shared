#!/usr/bin/env bash
set -euo pipefail
if [[ ${SET_X:-} ]]; then
  set -x
fi
IFS=$'\n\t'

trap 'nginx -s quit' SIGTERM SIGINT

config='daemon off;'

# To include headers in the logs (and a lot more)
if [[ ${VERBOSE:-} || ${DEBUG:-} ]]; then
  config+=' error_log /dev/stderr debug;'
fi

# shellcheck disable=SC1091
. "$HOME"/.dotfiles_bootstrap.sh
# shellcheck disable=SC1091
. "$DOTFILES_INCLUDES"/bash_shared.sh

echo_eval "nginx -g '$config'" &

echo_eval 'tail -f -n0 %q/var/log/nginx/*.log' "$HOMEBREW_PREFIX"
